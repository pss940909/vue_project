"use strict";(self["webpackChunkvue_finalproject"]=self["webpackChunkvue_finalproject"]||[]).push([[517],{2517:function(e,t,l){l.r(t),l.d(t,{default:function(){return We}});var a=l(3396),o=l(7139);const s={class:"text-end mt-4"},i={class:"table mt-4"},r=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{width:"120"},"分類"),(0,a._)("th",null,"產品名稱"),(0,a._)("th",{width:"120"},"原價"),(0,a._)("th",{width:"120"},"售價"),(0,a._)("th",{width:"100"},"是否啟用"),(0,a._)("th",{width:"200"},"編輯")])],-1),d={class:"text-right"},c={class:"text-right"},n={key:0,class:"text-success"},u={key:1,class:"text-muted"},p={class:"btn-group"},m=["onClick"],g=["onClick"],h={class:"d-flex justify-content-center"};function _(e,t,l,_,b,f){const P=(0,a.up)("vue-loading"),v=(0,a.up)("vue-pagination"),y=(0,a.up)("product-modal"),w=(0,a.up)("del-modal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(P,{active:b.isLoading},null,8,["active"]),(0,a._)("div",s,[(0,a._)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>f.showProductModal(!0))}," 新增產品 ")]),(0,a._)("table",i,[r,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(b.products,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,o.zw)(t.category),1),(0,a._)("td",null,(0,o.zw)(t.title),1),(0,a._)("td",d,(0,o.zw)(e.$filters.currency(t.origin_price)),1),(0,a._)("td",c,(0,o.zw)(e.$filters.currency(t.price)),1),(0,a._)("td",null,[t.is_enabled?((0,a.wg)(),(0,a.iD)("span",n,"啟用")):((0,a.wg)(),(0,a.iD)("span",u,"未啟用"))]),(0,a._)("td",null,[(0,a._)("div",p,[(0,a._)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>f.showProductModal(!1,t)}," 編輯 ",8,m),(0,a._)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>f.showDelModal(t)}," 刪除 ",8,g)])])])))),128))])]),(0,a._)("div",h,[(0,a.Wm)(v,{pages:b.pagination,onChangePage:f.getProducts},null,8,["pages","onChangePage"])]),(0,a.Wm)(y,{ref:"productModal",product:b.tempProduct,isNew:b.isNew,onUpdateProduct:f.updateProduct},null,8,["product","isNew","onUpdateProduct"]),(0,a.Wm)(w,{ref:"delModal",product:b.tempProduct,onDelProduct:f.delProduct},null,8,["product","onDelProduct"])],64)}l(7658);var b=l(9242);const f={class:"modal",ref:"modal"},P={class:"modal-dialog modal-xl",role:"document"},v={class:"modal-content border-0"},y=(0,a._)("div",{class:"modal-header bg-dark text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,a._)("span",null,"新增產品")]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),w={class:"modal-body"},k={class:"row"},x={class:"col-sm-4"},M={class:"mb-3"},U=(0,a._)("label",{for:"image",class:"form-label"},"輸入主要圖片網址",-1),D={class:"mb-3"},C=(0,a._)("label",{for:"customFile",class:"form-label"},[(0,a.Uk)("或 上傳主要圖片 "),(0,a._)("i",{class:"fas fa-spinner fa-spin"})],-1),$=["src","alt"],q={key:0,class:"mt-5"},V=["onUpdate:modelValue"],N=["onClick"],j={key:0},z={key:1},L=(0,a._)("small",{class:"text-danger"},"最多限上傳5張產品副圖",-1),B=[L],F={class:"col-sm-8"},R={class:"mb-3"},Z=(0,a._)("label",{for:"title",class:"form-label"},"標題",-1),I={key:0,class:"text-danger"},H={class:"row gx-2"},W={class:"mb-3 col-md-6"},Y=(0,a._)("label",{for:"category",class:"form-label"},"分類",-1),K={key:0,class:"text-danger"},A={class:"mb-3 col-md-6"},O=(0,a._)("label",{for:"price",class:"form-label"},"單位",-1),E={key:0,class:"text-danger"},G={class:"row gx-2"},J={class:"mb-3 col-md-6"},Q=(0,a._)("label",{for:"origin_price",class:"form-label"},"原價",-1),S={key:0,class:"text-danger"},T={class:"mb-3 col-md-6"},X=(0,a._)("label",{for:"price",class:"form-label"},"售價",-1),ee={key:0,class:"text-danger"},te=(0,a._)("hr",null,null,-1),le={class:"mb-3"},ae=(0,a._)("label",{for:"description",class:"form-label"},"產品描述",-1),oe={class:"mb-3"},se=(0,a._)("label",{for:"content",class:"form-label"},"說明內容",-1),ie={class:"mb-3"},re={class:"form-check"},de=(0,a._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ce={class:"modal-footer"};function ne(e,t,l,o,s,i){return(0,a.wg)(),(0,a.iD)("div",f,[(0,a._)("div",P,[(0,a._)("div",v,[y,(0,a._)("div",w,[(0,a._)("div",k,[(0,a._)("div",x,[(0,a._)("div",M,[U,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[0]||(t[0]=e=>s.tempProduct.imageUrl=e)},null,512),[[b.nr,s.tempProduct.imageUrl,void 0,{trim:!0}]])]),(0,a._)("div",D,[C,(0,a._)("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",name:"file-to-upload",onChange:t[1]||(t[1]=(...e)=>i.uploadFile&&i.uploadFile(...e))},null,544)]),(0,a._)("img",{class:"img-fluid",src:s.tempProduct.imageUrl,alt:s.tempProduct.title},null,8,$),s.tempProduct.imagesUrl?((0,a.wg)(),(0,a.iD)("div",q,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.tempProduct.imagesUrl,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:"mb-3 input-group",key:t},[(0,a.wy)((0,a._)("input",{type:"url",class:"form-control form-control",placeholder:"請輸入連結","onUpdate:modelValue":e=>s.tempProduct.imagesUrl[t]=e},null,8,V),[[b.nr,s.tempProduct.imagesUrl[t]]]),(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>s.tempProduct.imagesUrl.splice(t,1)}," 移除 ",8,N)])))),128)),i.canAddMoreImages?((0,a.wg)(),(0,a.iD)("div",j,[(0,a._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=e=>s.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):5==this.tempProduct.imagesUrl.length?((0,a.wg)(),(0,a.iD)("div",z,B)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)]),(0,a._)("div",F,[(0,a._)("div",R,[Z,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":t[3]||(t[3]=e=>s.tempProduct.title=e),onBlur:t[4]||(t[4]=e=>i.checkRequired("title"))},null,544),[[b.nr,s.tempProduct.title,void 0,{trim:!0}]]),s.errors.title?((0,a.wg)(),(0,a.iD)("small",I,"標題為必填的項目")):(0,a.kq)("",!0)]),(0,a._)("div",H,[(0,a._)("div",W,[Y,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":t[5]||(t[5]=e=>s.tempProduct.category=e),onBlur:t[6]||(t[6]=e=>i.checkRequired("category"))},null,544),[[b.nr,s.tempProduct.category,void 0,{trim:!0}]]),s.errors.category?((0,a.wg)(),(0,a.iD)("small",K,"分類為必填的項目")):(0,a.kq)("",!0)]),(0,a._)("div",A,[O,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":t[7]||(t[7]=e=>s.tempProduct.unit=e),onBlur:t[8]||(t[8]=e=>i.checkRequired("unit"))},null,544),[[b.nr,s.tempProduct.unit,void 0,{trim:!0}]]),s.errors.unit?((0,a.wg)(),(0,a.iD)("small",E,"單位為必填的項目")):(0,a.kq)("",!0)])]),(0,a._)("div",G,[(0,a._)("div",J,[Q,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"origin_price",placeholder:"請輸入原價","onUpdate:modelValue":t[9]||(t[9]=e=>s.tempProduct.origin_price=e),onBlur:t[10]||(t[10]=e=>i.checkRequired("origin_price"))},null,544),[[b.nr,s.tempProduct.origin_price,void 0,{number:!0}]]),s.errors.origin_price?((0,a.wg)(),(0,a.iD)("small",S,"原價為必填的項目")):(0,a.kq)("",!0)]),(0,a._)("div",T,[X,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入售價","onUpdate:modelValue":t[11]||(t[11]=e=>s.tempProduct.price=e),onBlur:t[12]||(t[12]=e=>i.checkRequired("price"))},null,544),[[b.nr,s.tempProduct.price,void 0,{number:!0}]]),s.errors.price?((0,a.wg)(),(0,a.iD)("small",ee,"售價為必填的項目")):(0,a.kq)("",!0)])]),te,(0,a._)("div",le,[ae,(0,a.wy)((0,a._)("textarea",{type:"text",class:"form-control",id:"description",placeholder:"請輸入產品描述","onUpdate:modelValue":t[13]||(t[13]=e=>s.tempProduct.description=e)},null,512),[[b.nr,s.tempProduct.description]])]),(0,a._)("div",oe,[se,(0,a.wy)((0,a._)("textarea",{type:"text",class:"form-control",id:"content",placeholder:"請輸入產品說明內容","onUpdate:modelValue":t[14]||(t[14]=e=>s.tempProduct.content=e)},null,512),[[b.nr,s.tempProduct.content]])]),(0,a._)("div",ie,[(0,a._)("div",re,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[15]||(t[15]=e=>s.tempProduct.is_enabled=e)},null,512),[[b.e8,s.tempProduct.is_enabled,void 0,{trim:!0}]]),de])])])])]),(0,a._)("div",ce,[(0,a._)("button",{type:"submit",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:t[16]||(t[16]=(0,b.iM)(((...t)=>e.hideModal&&e.hideModal(...t)),["prevent"]))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:t[17]||(t[17]=(...e)=>i.updateProduct&&i.updateProduct(...e))}," 確認 ")])])])],512)}var ue=l(4667),pe={data(){return{modal:{},tempProduct:{},errors:{title:null,category:null,unit:null,origin_price:null,price:null}}},mixins:[ue.Z],props:{product:{type:Object,default(){return{}}},isNew:{type:Boolean}},computed:{canAddMoreImages(){return 0==this.tempProduct.imagesUrl.length||5!=this.tempProduct.imagesUrl.length&&!!this.tempProduct.imagesUrl[this.tempProduct.imagesUrl.length-1]}},watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])},isNew:{handler(e){this.errors=e?{title:null,category:null,unit:null,origin_price:null,price:null}:{title:!1,category:!1,unit:!1,origin_price:!1,price:!1}},immediate:!0},errors:{handler(e,t){console.log(e,t)},immediate:!0,deep:!0}},methods:{updateProduct(){Object.values(this.errors).every((e=>0==e))?this.$emit("updateProduct",this.tempProduct):alert("表單未完整填寫，請重新確認")},checkRequired(e){this.tempProduct[e]?this.errors[e]=!1:this.errors[e]=!0},uploadFile(){console.dir(this.$refs.fileInput.files[0].name);const e=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",e);const l="https://vue3-course-api.hexschool.io/api/pss940909/admin/upload";this.axios.post(l,t).then((e=>{console.log(e.data.imageUrl),e.data.success&&(this.tempProduct.imageUrl=e.data.imageUrl)}))}}},me=l(89);const ge=(0,me.Z)(pe,[["render",ne]]);var he=ge;const _e={class:"modal fade",id:"delModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},be={class:"modal-dialog"},fe={class:"modal-content"},Pe={class:"modal-header bg-danger text-white"},ve={class:"modal-title",id:"exampleModalLabel"},ye=(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),we={class:"modal-body"},ke={class:"modal-footer"};function xe(e,t,l,s,i,r){return(0,a.wg)(),(0,a.iD)("div",_e,[(0,a._)("div",be,[(0,a._)("div",fe,[(0,a._)("div",Pe,[(0,a._)("h5",ve," 確定刪除"+(0,o.zw)(l.product.title)+"? ",1),ye]),(0,a._)("div",we," 確定要刪除"+(0,o.zw)(l.product.title)+"嗎？(刪除後無法恢復) ",1),(0,a._)("div",ke,[(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[0]||(t[0]=(...t)=>e.hideModal&&e.hideModal(...t))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...e)=>r.confirmDel&&r.confirmDel(...e))}," 確定刪除 ")])])])],512)}var Me={data(){return{modal:{}}},props:["product"],mixins:[ue.Z],methods:{confirmDel(){this.$emit("delProduct",this.product)}}};const Ue=(0,me.Z)(Me,[["render",xe]]);var De=Ue;const Ce={"aria-label":"Page navigation example"},$e={class:"pagination"},qe=(0,a._)("a",{class:"page-link","aria-label":"Previous"},[(0,a._)("span",{"aria-hidden":"true"},"«")],-1),Ve=[qe],Ne=["onClick"],je={class:"page-link"},ze=(0,a._)("a",{class:"page-link","aria-label":"Next"},[(0,a._)("span",{"aria-hidden":"true"},"»")],-1),Le=[ze];function Be(e,t,l,s,i,r){return(0,a.wg)(),(0,a.iD)("nav",Ce,[(0,a._)("ul",$e,[(0,a._)("li",{class:(0,o.C_)(["page-item",{disabled:!l.pages.has_pre}]),onClick:t[0]||(t[0]=(0,b.iM)((e=>r.changePage(l.pages.current_page-1)),["prevent"]))},Ve,2),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.pages.total_pages,(e=>((0,a.wg)(),(0,a.iD)("li",{class:(0,o.C_)(["page-item",{active:l.pages.current_page==e}]),key:e,onClick:(0,b.iM)((t=>r.changePage(e)),["prevent"])},[(0,a._)("a",je,(0,o.zw)(e),1)],10,Ne)))),128)),(0,a._)("li",{class:(0,o.C_)(["page-item",{disabled:!l.pages.has_next}]),onClick:t[1]||(t[1]=(0,b.iM)((e=>r.changePage(l.pages.current_page+1)),["prevent"]))},Le,2)])])}var Fe={data(){return{}},props:["pages"],methods:{changePage(e){this.$emit("changePage",e)}}};const Re=(0,me.Z)(Fe,[["render",Be]]);var Ze=Re,Ie={components:{ProductModal:he,DelModal:De,VuePagination:Ze},data(){return{isLoading:!1,products:[],pagination:{},tempProduct:{},isNew:!0}},inject:["emitter"],methods:{getProducts(e=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/pss940909/admin/products?page=${e}`;this.axios.get(t).then((e=>{console.log(e.data),e.data.success&&(this.isLoading=!1,this.products=e.data.products,this.pagination=e.data.pagination)}))},showProductModal(e,t){this.$refs.productModal.showModal(),this.isNew=e,this.tempProduct=e?{}:t},showDelModal(e){this.tempProduct=e,this.$refs.delModal.showModal()},updateProduct(e){if(this.tempProduct=e,this.isNew){const e="https://vue3-course-api.hexschool.io/api/pss940909/admin/product";this.axios.post(e,{data:this.tempProduct}).then((e=>{e.data.success?(this.$refs.productModal.hideModal(),this.emitter.emit("push-message",{style:"success",title:"更新成功"}),this.getProducts()):this.emitter.emit("push-message",{style:"danger",title:"更新失敗",content:e.data.message.join("、")})}))}else{const e=`https://vue3-course-api.hexschool.io/api/pss940909/admin/product/${this.tempProduct.id}`;this.axios.put(e,{data:this.tempProduct}).then((e=>{console.log(e.data),this.$refs.productModal.hideModal(),this.getProducts()}))}},delProduct(e){const t=`https://vue3-course-api.hexschool.io/api/pss940909/admin/product/${e.id}`;this.axios.delete(t).then((e=>{console.log(e.data),e.data.success&&(this.$refs.delModal.hideModal(),this.getProducts())}))}},created(){this.getProducts()}};const He=(0,me.Z)(Ie,[["render",_]]);var We=He}}]);
//# sourceMappingURL=517.19cfa3a7.js.map